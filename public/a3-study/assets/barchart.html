<!DOCTYPE html>
<div id="container"></div>
<script src="../../revisitUtilities/revisit-communicate.js"></script>
<script type="module">
    import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
    import Question from "./shared/question.js";

    const q = new Question();

    Revisit.postAnswers({
        'true-percent': q.truePercent,
        'lesser-value': q.lesserVal,
        'greater-value': q.greaterVal,
        'chart-type': 'bar'
    });

    const container = document.getElementById("container");

    //set dimensions
    const width = 540;
    const height = 400;
    const marginTop = 20;
    const marginRight = 20;
    const marginBottom = 30;
    const marginLeft = 40;

    const x = d3.scaleLinear()
        .domain([0, q.dataPoints.length])
        .range([marginLeft, width - marginRight]);

    const y = d3.scaleLinear()
        .domain([0, 100])
        .range([height - marginBottom, marginTop]);

    const svg = d3.create("svg")
        .attr("width", width)
        .attr("height", height + 110);

    svg.append("g")
        .attr("transform", `translate(0,${height - marginBottom})`)
        .call(d3.axisBottom(x).ticks(q.dataPoints.length).tickFormat(() => ""));

    svg.append("g")
        .attr("transform", `translate(${marginLeft},0)`)
        .call(d3.axisLeft(y).ticks(1));

    const barWidth = ((width - marginLeft - marginRight)/q.dataPoints.length - 2);

    svg.append("g")
        .attr("fill", "#c2d4f2")
        .selectAll()
        .data(q.dataPoints)
        .join("rect")
        .attr("x", (d, i) => x(i))
        .attr("y", d => y(d))
        .attr("stroke", "black")
        .attr("stroke-width", 3)
        .attr("height", d => y(0) - y(d))
        .attr("width", barWidth)

    const dataWithIndex = q.dataPoints.map((d, i) => ({value: d, index: i}))

    svg.append("g")
        .selectAll()
        .data(dataWithIndex.filter(d => q.indexesToCompare.includes(d.index)))
        .join("rect")
        .attr("x", d => (x(d.index) + (barWidth / 2)) -10)
        .attr("y", 400)
        .attr("height", 90)
        .attr("width", 20)
        .attr("fill", d => (d.index === q.indexesToCompare[0]) ? "#f04400" : "black");

    svg.append("g")
        .selectAll("path")
        .data(dataWithIndex.filter(d => q.indexesToCompare.includes(d.index)))
        .join("path")
        .attr("d", d3.symbol().type(d3.symbolTriangle).size(400))
        .attr("transform", d =>  `translate(${(x(d.index) + (barWidth / 2))}, 400)`)
        .attr("fill", d => (d.index === q.indexesToCompare[0]) ? "#f04400" : "black");

    container.append(svg.node());

</script>