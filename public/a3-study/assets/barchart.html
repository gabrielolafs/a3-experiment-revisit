<!DOCTYPE html>
<div id="container"></div>
<script type="module">

    import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

    import * as randomData from "./shared/genRandomData.js";

    const container = document.getElementById("container");

    let dataPoints = randomData.getData();
    let compareIndexes = randomData.getBarsToCompare(dataPoints);

    //set dimensions
    const width = 540;
    const height = 400;
    const marginTop = 20;
    const marginRight = 20;
    const marginBottom = 30;
    const marginLeft = 40;

    const x = d3.scaleLinear()
        .domain([0, dataPoints.length])
        .range([marginLeft, width - marginRight]);

    const y = d3.scaleLinear()
        .domain([0, 100])
        .range([height - marginBottom, marginTop]);

    const svg = d3.create("svg")
        .attr("width", width)
        .attr("height", height + 200);

    svg.append("g")
        .attr("transform", `translate(0,${height - marginBottom})`)
        .call(d3.axisBottom(x).ticks(dataPoints.length).tickFormat(() => ""));

    svg.append("g")
        .attr("transform", `translate(${marginLeft},0)`)
        .call(d3.axisLeft(y).ticks(1));

    const barWidth = ((width - marginLeft - marginRight)/dataPoints.length - 2);

    svg.append("g")
        .attr("fill", "#c2d4f2")
        .selectAll()
        .data(dataPoints)
        .join("rect")
        .attr("x", (d, i) => x(i))
        .attr("y", d => y(d))
        .attr("stroke", "black")
        .attr("stroke-width", 3)
        .attr("height", d => y(0) - y(d))
        .attr("width", barWidth)

    const dataWithIndex = dataPoints.map((d, i) => ({value: d, index: i}))

    svg.append("g")
        .selectAll()
        .data(dataWithIndex.filter(d => compareIndexes.includes(d.index)))
        .join("rect")
        .attr("x", d => (x(d.index) + (barWidth / 2)) -10)
        .attr("y", 400)
        .attr("height", 120)
        .attr("width", 20)
        .attr("fill", d => (d.index === Math.min(...compareIndexes)) ? "#f04400" : "black");

    svg.append("g")
        .selectAll("path")
        .data(dataWithIndex.filter(d => compareIndexes.includes(d.index)))
        .join("path")
        .attr("d", d3.symbol().type(d3.symbolTriangle).size(400))
        .attr("transform", d =>  `translate(${(x(d.index) + (barWidth / 2))}, 400)`)
        .attr("fill", d => (d.index === Math.min(...compareIndexes)) ? "#f04400" : "black");

    container.append(svg.node());

</script>